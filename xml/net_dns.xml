<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter [
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="cha.dns">
 <title>ドメインネームシステム</title>
 <info>
  <abstract>
   <para>DNS (ドメインネームシステム; Domain Name System) は、ドメイン名やホスト名を IP アドレスに解決するために必要なシステムです。この仕組みにより、たとえば IP アドレス &wsIip; とホスト名 <literal>&wsI;</literal> を結びつけることができるようになります。お使いの環境で独自のネームサーバを構築する前に、まずは <xref linkend="sec.network.nameres"/> に書かれている DNS の一般的な情報をお読みください。また、下記の設定例では、既定のネームサーバである bind を使用して説明しています。</para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec.dns.basic">
  <title>DNS で使用される用語</title>

  <variablelist>
   <varlistentry>
    <term>ゾーン</term>
    <listitem>
     <para>ドメイン名は複数のゾーンに分割することができます。たとえば <literal>&exampledomain;</literal> というドメイン名の場合、 <literal>com</literal> ドメイン内の <literal>example</literal> というセクション (ゾーン) であることになります。</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DNS サーバ</term>
    <listitem>
     <para>DNS サーバとは、ドメインに対して名前と IP アドレスの情報を保持するサーバを意味します。 DNS サーバには、必要に応じて複数のゾーン (マスターゾーンとスレーブゾーン) が設定されるほか、ゾーンを持たないキャッシュ専用のスレーブサーバもあります。</para>
     <variablelist>
      <varlistentry>
       <term>マスターゾーン DNS サーバ</term>
       <listitem>
        <para>マスターゾーンには、特定のドメイン内での全ホストについて、その最新情報が登録されています。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>スレーブゾーン DNS サーバ</term>
       <listitem>
        <para>スレーブゾーンはマスターゾーンのコピーを意味します。 DNS サーバはマスターサーバから、スレーブゾーンとして設定されたゾーンの転送を行ないます。スレーブゾーンは、その情報が有効である限り (有効期限が切れない範囲) において、信頼できる情報源であるものとされます。マスターサーバと通信ができなくなり、その情報の有効期限が切れると、 DNS サーバはそのゾーンに対する応答を行なわなくなります。</para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>フォワーダ</term>
    <listitem>
     <para>フォワーダとは、お使いの DNS サーバがその問い合わせに応答できない場合に、その問い合わせの転送先となる DNS サーバを意味します。 1 つの設定内で複数の設定ソースを利用したい場合は、 <literal>netconfig</literal> を使用します (詳しくは <command>man 8 netconfig</command> をお読みください) 。</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>レコード</term>
    <listitem>
     <para>レコードとは名前や IP アドレスに関する情報を意味します。対応するレコードとその書式については、 BIND のドキュメンテーションに説明があります。下記にいくつかの特殊なレコードを示します:</para>
     <variablelist>
      <varlistentry>
       <term>NS レコード</term>
       <listitem>
        <para>NS レコードとは、指定したドメイン (ゾーン) を受け持つネームサーバを示すためのレコードです。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>MX レコード</term>
       <listitem>
        <para>MX (メール交換; Mail eXchange) レコードとは、インターネットを介して電子メールを交換する際、そのドメイン宛のメールを受信するメールサーバを示すためのレコードです。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>SOA レコード</term>
       <listitem>
        <para>SOA (権威開始; Start Of Authority) レコードとは、ゾーンファイル内で最初に作成すべきレコードです。 SOA レコードは、複数のコンピュータ間でデータを同期する際に使用します。</para>
       </listitem>
      </varlistentry>
     </variablelist>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
<!-- ================================================================== -->
 <sect1 xml:id="sec.dns.install">
  <title>インストール</title>

  <para>DNS サーバをインストールするには、 &yast; を起動して <menuchoice><guimenu>ソフトウエア</guimenu> <guimenu>ソフトウエア管理</guimenu></menuchoice> を選択します。その後 <menuchoice><guimenu>表示</guimenu><guimenu>パターン</guimenu></menuchoice> を選択して <guimenu>DHCP および DNS サーバ</guimenu> を選択します。あとは <guimenu>了解</guimenu> を押して必要なパッケージをインストールします。</para>
  <para>上記以外にも、下記のコマンドラインを入力してもかまいません:</para>
  <screen>&prompt.sudo;zypper in -t pattern dhcp_dns_server</screen>
 </sect1>
<!-- ================================================================== -->
 <sect1 xml:id="sec.dns.yast">
  <title>&yast; での設定</title>

  <para>ローカルネットワーク内で DNS サーバを設定したい場合は、 &yast; の DNS モジュールをお使いください。初めてこのモジュールを起動した場合はウイザードが表示され、サーバの管理に関わるいくつかの決定を行なうことになります。この初期設定を完了すると、基本的なサーバ設定が作成されます。 ACL やログ、 TSIG 鍵やその他のオプションなど、より高度な設定を行ないたい場合は、熟練者モードをお使いください。</para>

  <sect2 xml:id="sec.dns.yast.wizard">
   <title>ウイザードによる設定</title>
<!-- note to myself (ke): -->
<!-- remove /var/lib/YaST2/dns_server to enforce wizard mode -->
   <para>このウイザードは 3 つの手順 (ダイアログ) から構成されています。熟練者モードへの移行は、それが可能になった段階で表示されるようになっています。</para>
   <procedure>
    <step>
     <para><!-- 2014-04-24, ke: bnc#875014: asking for clarification --> <!-- ATM, it is rather generic --> <!-- 2014-05-13, ke: Thus far (beta6), it is still somehow open... --> 初めて本モジュールを起動した場合は、 <xref linkend="fig.yast2.dnsinst.forwarders"/> に示されている <guimenu>フォワーダの設定</guimenu> ダイアログが表示されます。ここでは、 <guimenu>ローカル DNS の解決ポリシー</guimenu> で下記のいずれかを選択することができます:</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para><guimenu>フォワーダの合成を無効にする</guimenu> <!-- (= disable DNS configuration updates via netconfig by setting NETCONFIG_DNS_POLICY='') --></para>
      </listitem>
      <listitem>
       <para><guimenu>自動的に合成する</guimenu> <!-- (= enable automatic DNS configuration updates via netconfig by setting NETCONFIG_DNS_POLICY='auto'; behavior depends on nw in use or not; netconfig will update resolv.conf with info (forwarder list) provided by dhcp/ppp) --></para>
      </listitem>
      <listitem>
<!-- FIXME -->
<!-- bnc#875014: 'static' is invalid -->
       <para><guimenu>フォワーダの合成を有効にする</guimenu> <!-- (NETCONFIG_DNS_POLICY='static') --></para>
      </listitem>
      <listitem>
       <para><!-- (NETCONFIG_DNS_POLICY='STATIC').--> <guimenu>独自設定</guimenu>: これを選択すると、 <guimenu>カスタムポリシー</guimenu> を指定することができるようになります。既定では (<guimenu>自動的に合成する</guimenu> が選択されるため) 、 <guimenu>カスタムポリシー</guimenu> が <literal>auto</literal> に設定されますが、ここにはインターフェイス名のほか、 <literal>STATIC</literal> や <literal>STATIC_FALLBACK</literal> のような特殊ポリシー名を指定することができます。</para>
      </listitem>
     </itemizedlist>
<!--
      The
      <guimenu>Netconfig DNS Policy</guimenu> decides which devices should
      provide forwarders or whether you want to supply your own
      <guimenu>Forwarder List</guimenu>.
     -->
     <para><guimenu>ローカル DNS 解決器のフォワーダ</guimenu> では、どのサービスを使用するのかを選択します。 <guimenu>システムのネームサーバを使用する</guimenu> , <guimenu>このネームサーバ (bind)</guimenu> , <guimenu>ローカルの dnsmasq サーバ</guimenu> の中からいずれかを選択してください。</para>
     <para>これら全ての設定に関する詳細は、 <command>man 8 netconfig</command> をお読みください。</para>
     <figure xml:id="fig.yast2.dnsinst.forwarders">
      <title>DNS サーバのインストール: フォワーダの設定</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_forw.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>フォワーダとは、お使いの DNS サーバがその問い合わせに応答できない場合に、その問い合わせの転送先となる DNS サーバを意味します。フォワーダの IP アドレスを入力して、 <guimenu>追加</guimenu> を押してください。</para>
    </step>
    <step>
     <para><guimenu>DNS ゾーン</guimenu> ダイアログではゾーンファイル (詳しくは <xref linkend="sec.dns.zonefile"/> をお読みください) の管理を行ないます。新しいゾーンを作成するには、 <guimenu>名前</guimenu> 欄にゾーンの名前を入力します。なお、逆引きゾーンを作成する場合は、ゾーンの名前が <literal>.in-addr.arpa</literal> で終わらなければなりません。また、 <guimenu>種類</guimenu> (マスター／スレーブ／転送) も選択する必要があります。詳しくは <xref linkend="fig.yast2.dnsinst.zones"/> をお読みください。既存のゾーンを編集したい場合は、ゾーンを選択して <guimenu>編集</guimenu> を押します。ゾーンを削除したい場合は、ゾーンを選択して <guimenu>削除</guimenu> を押します。</para>
     <figure xml:id="fig.yast2.dnsinst.zones">
      <title>DNS サーバのインストール: DNS ゾーン</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_zone.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_zone.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>最後のダイアログでは残りの設定を行ないます。 <guimenu>ファイアウオールでポートを開く</guimenu> を選択すると、ファイアウオールで DNS のポートを開くことができます。また、システムの起動時に DNS サーバを開始するかどうかを設定することもできる (<guimenu>オン</guimenu> または <guimenu>オフ</guimenu>) ほか、 LDAP サポートを有効化することもできます。詳しくは <xref linkend="fig.yast2.dnsinst.finish"/> をご覧ください。</para>
     <figure xml:id="fig.yast2.dnsinst.finish">
      <title>DNS サーバのインストール: ウイザードの完了</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata width="72%" fileref="yast2_dns_wiz_finish.png" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata width="75%" fileref="yast2_dns_wiz_finish.png" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.dns.yast.expert">
   <title>熟練者向け設定</title>
   <para>モジュールを起動すると、 &yast; は複数の設定オプションを表わすウインドウを表示します。これらの設定を行なうことで、 DNS サーバの基本的な機能を適用することができるようになります:</para>
   <sect3 xml:id="sec.dns.yast.expert.startup">
    <title>起動</title>
    <para><guimenu>起動</guimenu> では、 DNS サーバをシステムの起動時に開始するかどうかを選択することができます。 DNS サーバを今すぐに開始したい場合は、 <guimenu>今すぐ開始</guimenu> を押してください。 DNS サーバを停止するには、 <guimenu>今すぐ停止</guimenu> を押してください。現在の設定を保存するには、 <guimenu>設定保存後に再読み込みする</guimenu> を選択してください。 <!-- <figure id="fig.yast2.dns.startup"> <title>DNS Server: Start-up</title> <screenshot> <mediaobject> <imageobject role="fo"> <imagedata width="75%" fileref="yast2_dns_def_startup.png" format="PNG"/> </imageobject> <imageobject role="html"> <imagedata width="75%" fileref="yast2_dns_def_startup.png" format="PNG"/> </imageobject> </mediaobject> </screenshot> </figure>--> ファイアウオールで DNS のポートを開くには、 <guimenu>ファイアウオールでポートを開く</guimenu> を選択して、 <guimenu>ファイアウオールの詳細</guimenu> で必要に応じて設定を変更してください。</para>
    <para><guimenu>LDAP サポートを有効にする</guimenu> を選択すると、ゾーンファイルが LDAP データベース内に保存されるようになります。 LDAP データベースに書き込まれたゾーンデータを修正した場合は、 DNS サーバの再起動や再読み込みでそれが反映されるようになります。</para>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.forwarders">
    <title>フォワーダ</title>
    <para>ローカルの DNS サーバが特定の問い合わせに応答できない場合、その問い合わせを <guimenu>フォワーダ</guimenu> で設定したサーバに転送することができます。このフォワーダは、 <guimenu>フォワーダの一覧</guimenu> 内に手作業で追加して設定します。ダイアルアップ接続の場合など、固定では設定できない環境の場合は、 <guimenu>netconfig</guimenu> が設定を取り扱います。 netconfig について、詳しくは <command>man 8 netconfig</command> をお読みください。</para>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.basics">
    <title>基本オプション</title>
    <para>このセクションでは基本的なサーバ設定を行ないます。 <guimenu>オプション</guimenu> で設定したい項目を一覧から選んで、右側に設定したい値を入力してください。入力が終わったら <guimenu>追加</guimenu> を押すと、設定を追加することができます。</para>
<!--
      <figure id="fig.yast2.dns.basicoptions">
       <title>DNS Server: Basic Options</title>
       <screenshot>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_basicoptions.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_basicoptions.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </screenshot>
      </figure>
-->
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.logging">
    <title>ログ</title>
    <para>DNS サーバでのログ記録を設定するには、 <guimenu>ログ</guimenu> を選択します。 <guimenu>ログの種類</guimenu> では、 DNS サーバからのログの保存先を指定します。 <guimenu>システムログ</guimenu> を選択するとシステム全体のログファイルに、 <guimenu>ファイル</guimenu> を選択すると指定したファイルに保存することができます。後者の場合はファイル名のほか、メガバイト単位で最大ファイルサイズと、残しておくべき過去のログファイル数 (バージョン) を指定することができます。</para>
    <para>さらに詳しいオプションが <guimenu>追加ログ</guimenu> 内に用意されています。 <guimenu>すべての DNS への問い合わせ</guimenu> を選択すると、届いた全ての問い合わせをログに記録するようになりますので、ログファイルが非常に大きくなることに注意してください。そのため、デバッグの目的がある場合を除いて、有効化することはお勧めできません。また、 DHCP サーバと DNS サーバの間でのゾーン更新時にログを記録したい場合は、 <guimenu>ゾーン更新をログに記録</guimenu> を選択してください。また、マスターサーバからスレーブサーバへのゾーン転送をログに記録したい場合は、 <guimenu>ゾーン転送をログに記録</guimenu> を選択してください。詳しくは <xref linkend="fig.yast2.dns.logging"/> をお読みください。</para>
    <figure xml:id="fig.yast2.dns.logging">
     <title>DNS サーバ: ログ</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="75%" fileref="yast2_dns_def_logging.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.acls">
    <title>ACL</title>
    <para>このダイアログでは ACL (アクセス制御リスト; Access Control List) を定義して、アクセス制限を設定することができます。 <guimenu>名前</guimenu> 欄に他と重複しない名前を設定し、 <guimenu>値</guimenu> 欄に IP アドレス (ネットマスクは設定してもいなくてもかまいません) を指定することで、 ACL を定義することができます。値は下記のように記述します:</para>
<screen>{ 192.168.1/24; }</screen>
    <para>設定ファイルの書式により、アドレスの末尾にはセミコロンを付けるほか、値を波括弧で括ってください。</para>
<!--
      <figure id="fig.yast2.dns.acl">
       <title>DNS Server: ACLs</title>
       <screenshot>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_acl.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_acl.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </screenshot>
      </figure>
-->
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.tsig">
    <title>TSIG 鍵</title>
    <para>TSIG (トランザクション署名; Transaction SIGnatures) の主な目的は、 DHCP サーバと DNS サーバとの間で機密を保持する通信を行なうことにあります。詳しくは <xref linkend="sec.dns.tsig"/> で説明しています。</para>
    <para>TSIG 鍵を生成するには、 <guimenu>鍵 ID</guimenu> の欄に他と重複しない名前を入力し、 <guimenu>ファイル名</guimenu> の欄に保存先のファイル名を指定したあと、 <guimenu>生成</guimenu> を押します。</para>
    <para>以前に作成した鍵を使用したい場合は、 <guimenu>鍵 ID</guimenu> の欄には何も入力せず、 <guimenu>ファイル名</guimenu> の欄で既存のファイルのファイル名を入力してください。入力が終わったら <guimenu>追加</guimenu> を押します。</para>
<!--
    <figure id="fig.yast2_dns_def_tsig">
    <title>DNS Server: TSIG Keys</title>
    <screenshot>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_tsig.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_tsig.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </screenshot>
      </figure>
-->
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.add_slave">
    <title>DNS ゾーン (スレーブゾーンの追加)</title>
    <para>スレーブゾーンを追加するには、 <guimenu>DNS ゾーン</guimenu> を選択して、 <guimenu>種類</guimenu> で <guimenu>スレーブ</guimenu> を選択します。その後ゾーンの名前を入力して <guimenu>追加</guimenu> を押します。</para>
    <para><guimenu>ゾーンエディタ</guimenu> サブダイアログ内の <guimenu>マスター DNS サーバの IP</guimenu> では、スレーブサーバが情報を取得する際のマスターサーバを指定します。また、サーバへのアクセスを制限したい場合は、表示された ACL の一覧から必要なものを選択します。 <!-- See <xref linkend="fig.yast2.dns.zoneeditor"/>. --></para>
<!--
    <figure id="fig.yast2.dns.zoneeditor">
     <title>DNS Server: Slave Zone Editor</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="75%" fileref="yast2_dns_def_zoneeditor.png" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="75%" fileref="yast2_dns_def_zoneeditor.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure> -->
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.add_master">
    <title>DNS ゾーン (マスターゾーンの追加)</title>
    <para>マスターゾーンを追加するには、 <guimenu>DNS ゾーン</guimenu> を選択して <guimenu>種類</guimenu> で <guimenu>マスター</guimenu> を選択します。その後ゾーンの名前を入力して <guimenu>追加</guimenu> を押します。なお、マスターゾーンを追加する場合は、逆引きゾーンも必要となります。たとえば <systemitem>example.com</systemitem> というゾーンを追加して、そこに <literal>192.168.1.0/24</literal> というサブネット内のホストを設定する場合、その IP アドレスを範囲内とする逆引きゾーンを追加する必要があります。この逆引きゾーンは、一般に <literal>1.168.192.in-addr.arpa</literal> という名前であるべきものです。</para>
   </sect3>
   <sect3 xml:id="sec.dns.yast.expert.edit_master">
    <title>DNS ゾーン (マスターゾーンの編集)</title>
    <para>マスターゾーンを編集するには、 <guimenu>DNS ゾーン</guimenu> を選択して表の中からマスターゾーンを選択し、 <guimenu>編集</guimenu> を押します。ダイアログには下記のようなページが用意されています: <guimenu>基本</guimenu> (最初に表示されるページ) , <guimenu>NS レコード</guimenu> , <guimenu>MX レコード</guimenu> , <guimenu>SOA</guimenu> , <guimenu>レコード</guimenu></para>
    <para os="sles;osuse"><xref linkend="fig.yast2.dns.ddns"/> に示されている基本設定ダイアログでは、動的な DNS 更新の可否とクライアントやスレーブサーバに対するゾーン転送の設定を行なうことができます。ゾーンを動的に更新できるようにするには、 <guimenu>動的な更新の許可</guimenu> を選択したあと、対応する TSIG 鍵を選択する必要があります。鍵は更新処理の開始よりも前に定義しておかなければなりません。ゾーン転送を有効化するには、対応する ACL を選択します。 ACL はこの時点までに設定しておかなければなりません。</para>
    <para><guimenu>基本</guimenu> ダイアログでは、ゾーンの転送可否を設定します。表示された ACL を選択して、ゾーンのダウンロードを許可したい相手を選択してください。</para>
    <figure xml:id="fig.yast2.dns.ddns" os="sles;osuse">
     <title>DNS サーバ: ゾーンエディタ (基本)</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata width="65%" fileref="yast2_dns_def_ddns.png" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    <variablelist>
     <varlistentry>
      <term>ゾーンエディタ (NS レコード)</term>
      <listitem>
       <para><guimenu>NS レコード</guimenu> ダイアログでは、指定したゾーンでのネームサーバを設定することができます。なお、この一覧内には自分自身も含めておく必要があることに注意してください。レコードを追加するには、 <guimenu>追加するネームサーバ</guimenu> の欄に名前を入力して <guimenu>追加</guimenu> を押します。詳しくは <xref linkend="fig.yast2.dns.nsrec"/> をご覧ください。</para>
       <figure xml:id="fig.yast2.dns.nsrec">
        <title>DNS サーバ: ゾーンエディタ (NS レコード)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="65%" fileref="yast2_dns_def_nsrec.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ (MX レコード)</term>
      <listitem>
       <para>既存の一覧内に現在のゾーンに対するメールサーバを追加するには、まず対応するテキストボックス内にアドレスと優先度を入力します。それぞれ入力が終わったら <guimenu>追加</guimenu> を押します。詳しくは <xref linkend="fig.yast2.dns.mxrec"/> をご覧ください。</para>
       <figure xml:id="fig.yast2.dns.mxrec">
        <title>DNS サーバ: ゾーンエディタ (MX レコード)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="72%" fileref="yast2_dns_def_mxrec.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_mxrec.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ (SOA)</term>
      <listitem>
       <para>このページでは、 SOA (権威開始; Start Of Authority) レコードを作成します。個別のオプションに関する説明については、 <xref linkend="ex.welt.zone"/> をお読みください。 <phrase os="sles;osuse">ただし、 LDAP で管理されている動的ゾーンの場合は、 SOA レコードの変更には対応していません。</phrase></para>
       <figure xml:id="fig.yast2.dns.soa">
        <title>DNS サーバ: ゾーンエディタ (SOA)</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata width="75%" fileref="yast2_dns_def_soa.png" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ゾーンエディタ (レコード)</term>
      <listitem>
       <para>このダイアログでは、名前解決を管理します。 <guimenu>レコードキー</guimenu> にはホスト名を入力して、種類を選択します。種類に <guimenu>A</guimenu> を選択した場合は、 <guimenu>レコードキー</guimenu> がホスト名、 <guimenu>値</guimenu> が IP (IPv4) アドレスになります。同様に <guimenu>AAAA</guimenu> の場合は、 <guimenu>レコードキー</guimenu> がホスト名、 <guimenu>値</guimenu> が IPv6 アドレスになります。 <guimenu>CNAME</guimenu> の場合は <guimenu>レコードキー</guimenu> と <guimenu>値</guimenu> の両方がホスト名となり、一方から他方への別名定義を作成することができます。 <guimenu>NS</guimenu> と <guimenu>MX</guimenu> については、それぞれ <guimenu>NS レコード</guimenu> と <guimenu>MX レコード</guimenu> のタブで提供されているものと同じです。なお、 <guimenu>PTR</guimenu> は逆引きゾーンで使用するものです。これは <literal>A</literal> レコードの逆を意味するもので、たとえば下記のようになります:</para>
<screen>hostname.example.com. IN A 192.168.0.1
1.0.168.192.in-addr.arpa IN PTR hostname.example.com.</screen>
      </listitem>
     </varlistentry>
    </variablelist>
    <sect4 xml:id="sec.dns.yast.expert.edit_master.rev">
     <title>逆引きゾーンの追加</title>
     <para>逆引きゾーンを追加するには、下記の手順で行ないます:</para>
     <procedure>
      <step>
       <para><menuchoice><guimenu>&yast;</guimenu><guimenu>DNS サーバ</guimenu><guimenu>DNS ゾーン</guimenu></menuchoice> を選択します。</para>
      </step>
      <step>
       <para>まだ (逆引きではない) マスターゾーンを作成していない場合は、マスターゾーンを追加して <guimenu>編集</guimenu> を押します。</para>
      </step>
      <step>
       <para><guimenu>レコード</guimenu> タブに移動し、 <guimenu>レコードキー</guimenu> と <guimenu>値</guimenu> をそれぞれ入力して <guimenu>追加</guimenu> を押します。作業が終わったら <guimenu>OK</guimenu> を押します。 &yast; が NS サーバの設定についてエラーメッセージを表示した場合は、 <guimenu>NS レコード</guimenu> のタブでサーバを追加してください。</para>
       <figure>
        <title>マスターゾーンに対するレコードの追加</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone1.png" width="70%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para><guimenu>DNS ゾーン</guimenu> ウインドウに戻ったら、逆引きゾーンを追加します。</para>
       <figure>
        <title>逆引きゾーンの追加</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone2.png" width="70%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
      </step>
      <step>
       <para>逆引きゾーンを選択して <guimenu>編集</guimenu> し、 <guimenu>レコード</guimenu> タブに移動します。逆引きゾーンの場合、 <guimenu>PTR: 逆変換</guimenu> というレコードの種類が表示されるはずです。それぞれ対応する <guimenu>レコードキー</guimenu> と <guimenu>値</guimenu> を入力して <guimenu>追加</guimenu> を押し、作業が終わったら <guimenu>OK</guimenu> を押して閉じます。</para>
       <figure>
        <title>逆引きレコードの追加</title>
        <mediaobject>
         <imageobject role="fo">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%" format="PNG"/>
         </imageobject>
         <imageobject role="html">
          <imagedata fileref="yast2_dns_revzone3.png" width="70%" format="PNG"/>
         </imageobject>
        </mediaobject>
       </figure>
       <para>なお、必要であれば NS レコードも追加してください。</para>
      </step>
     </procedure>
     <tip>
      <title>逆引きゾーンの編集</title>
      <para>正引きのゾーンを追加したら、メインメニューに戻って逆引きゾーンを選択して、編集を行なってください。この中の <guimenu>基本</guimenu> タブ内には、 <guimenu>以下のものから自動的にレコードを生成</guimenu> というチェックボックスがありますので、このチェックを入れてから対応する正引きゾーンを選択すると、自動的にレコードを生成することができるようになります。これを設定しておくことで、正引きゾーンで何らかの変更を行なうと、それにあわせて逆引きゾーンが更新されるようになります。</para>
     </tip>
    </sect4>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dns.bind">
  <title>BIND ネームサーバの起動</title>

  <para>&productnamereg; システムでは、ネームサーバ BIND ( <emphasis>Berkeley Internet Name Domain</emphasis> ) が事前に設定された状態でインストールされます。これにより、インストールを行なうだけで、設定することなく起動できるようになっています。インターネットに接続されている環境であれば、 <filename>/etc/resolv.conf</filename> 内に設定するネームサーバのアドレスに、 <systemitem class="domainname">localhost</systemitem> を表わす <systemitem class="ipaddress">127.0.0.1</systemitem> を指定することで、プロバイダから提供される DNS 情報を利用することなく、名前が解決できるようになります。これは、 BIND にルートネームサーバの情報が含まれていることによるもので、それなりに遅い処理にはなりますが、いちおう解決することができます。通常はプロバイダのネームサーバを <filename>/etc/named.conf</filename> 内の <systemitem>forwarders</systemitem> に指定することで、効率的で素早く、かつ安全な解決を行ないます。このような構成で構築したネームサーバは、 <emphasis>キャッシュのみの</emphasis> ネームサーバと呼ばれます。ここから独自のゾーンを設定すれば、通常の DNS サーバと同じ構成になります。簡単な設定例については、 <filename>/usr/share/doc/packages/bind/config</filename> をお読みください。</para>

  <tip>
   <title>ネームサーバ情報の自動調整について</title>
   <para>インターネットやネットワークの接続方法によっては、現在の状況に合わせてネームサーバの情報を修正する必要がある場合があります。これを行ないたい場合は、 <filename>/etc/sysconfig/network/config</filename> 内の <systemitem>NETCONFIG_DNS_POLICY</systemitem> の値を、 <literal>auto</literal> に設定してください。</para>
  </tip>

  <para>ただし、公式にドメインを取得した場合を除いて、一般的なドメインに対するネームサーバを設定すべきではありません。また、ドメインを取得している場合でも、プロバイダ側に管理を委託しているような場合も、独自にそのドメインに対するサーバを構築することはお勧めできません。なぜなら、 BIND でそれらのドメインを設定してしまうと、ドメイン宛の問い合わせを転送しなくなってしまうためです。逆に、たとえばプロバイダ内に設置している Web サーバが存在するような場合、独自に構築したドメインにはアクセスできません。</para>

  <para>ネームサーバを開始するには、 <systemitem class="username">root</systemitem> で <command>systemctl start named</command> のコマンドを実行します。実行した後は、 <command>systemctl status named</command> コマンドで named (ネームサーバのプロセス名) の状態を確認することができます。ローカルでネームサーバの動作を確認するには、 <command>host</command> や <command>dig</command> のコマンドを使用します。たとえば <systemitem class="domainname">localhost</systemitem> のホストを問い合わせると、 <systemitem class="ipaddress">127.0.0.1</systemitem> という応答が返るはずです。応答がない場合や、正しい応答になっていない場合は、 <filename>/etc/resolv.conf</filename> 内のネームサーバが正しく設定されていないか、もしくはファイルそのものが存在していないものと思われます。たとえば <command>host</command> &nbsp; <option>127.0.0.1</option> のように実行してもエラーが返される場合は、何らかの問題があるものと考えられます。エラーメッセージを表示するには、 <command>systemctl status named</command> を実行して、まずはサーバそのものが動作しているかどうかを確認してください。ネームサーバが動作していない場合や、正しくない応答を返しているような場合は、 <command>journalctl -e</command> の出力結果をお読みください。</para>



  <para>プロバイダのネームサーバ (もしくは既にネットワーク内で動作しているネームサーバ) をフォワーダとして使用するには、 IP アドレスまたはホスト名を <systemitem>forwarders</systemitem> 内の <systemitem>options</systemitem> セクションに設定してください。なお、 <xref linkend="ex.forward"/> で設定しているアドレスは、あくまでも例として示しているものです。必要に応じて修正してください。</para>

  <example xml:id="ex.forward">
   <title>named.conf 内での転送オプション</title>
<!--adjust to standard network example-->
<!--hmm should be ok ... we did not define WAN DNS servers .. and this is not
too easy to do. -->
<screen>options {
        directory "/var/lib/named";
        forwarders { 10.11.12.13; 10.11.12.14; };
        listen-on { 127.0.0.1; &dnsip;; };
        allow-query { 127/8; 192.168/16 };
        notify no;
};</screen>
  </example>

  <para><systemitem>options</systemitem> の項目は <systemitem class="domainname">localhost</systemitem> や <systemitem>0.0.127.in-addr.arpa</systemitem> の後に続く項目です。また、 <quote>.</quote> 内の <literal>type hint</literal> は、必ず設定しておくべき項目です。これらについては変更することなく、そのまま残しておいてください。また、各項目の末尾には <quote>;</quote> を付けるとともに、必要な箇所に波括弧を入力してください。 <filename>/etc/named.conf</filename> やゾーンファイルを編集した後は、 BIND に対して再読み込みを指示するため、 <command>systemctl reload named</command> を実行してください。再読み込みは、ネームサーバを一旦停止して起動し直すことでも対応することができます (<command>systemctl restart named</command>) 。また、サーバを停止したい場合は、 <command>systemctl stop named</command> を実行してください。</para>
 </sect1>
 <sect1 xml:id="sec.dns.named">
  <title>/etc/named.conf 設定ファイル</title>

  <para>BIND ネームサーバ自身に対する全ての設定は、 <filename>/etc/named.conf</filename> 内に保存されます。自身が処理すべきドメインのゾーンデータ (ホスト名や IP アドレスなどの情報) については、 <filename>/var/lib/named</filename> ディレクトリ内の個別のファイル内に保存されます。これらの詳細は後述します。</para>

  <para>大きく分けると、 <filename>/etc/named.conf</filename> には 2 種類の領域があります。 1 つ目の領域は一般的な設定を記述する <systemitem>options</systemitem> セクション、もう 1 つは各ドメインに対する <systemitem>zone</systemitem> 項目です。 <systemitem>logging</systemitem> セクションと <systemitem>acl</systemitem> (アクセス制御リスト) セクションは任意で設定します。コメント行は <literal>#</literal> 記号もしくは <literal>//</literal> を行頭に入力します。最小限の設定の <filename>/etc/named.conf</filename> は、 <xref linkend="ex.named.mini"/> のようになります。</para>

  <example xml:id="ex.named.mini">
   <title>基本的な /etc/named.conf</title>
<screen>options {
        directory "/var/lib/named";
        forwarders { 10.0.0.1; };
        notify no;
};

zone "localhost" in {
       type master;
       file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
        type master;
        file "127.0.0.zone";
};

zone "." in {
        type hint;
        file "root.hint";
};</screen>
  </example>

  <sect2 xml:id="sec.dns.named.options">
   <title>主要な設定オプション</title>
   <variablelist>
    <varlistentry>
     <term>directory " <replaceable>ディレクトリ</replaceable> ";</term>
     <listitem>
      <para>BIND がゾーンデータを含むファイルを検索するディレクトリを指定します。通常は <filename>/var/lib/named</filename> を指定します。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forwarders { <replaceable>IP_アドレス</replaceable> ; };</term>
     <listitem>
      <para>ネームサーバが DNS の問い合わせを直接解決できない場合、その問い合わせを転送する先のネームサーバ (多くはプロバイダのネームサーバ) を指定します。 <replaceable>IP_アドレス</replaceable> はたとえば、 <literal>&dnsip;</literal> のように指定します。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>forward first;</term>
     <listitem>
      <para>ルートネームサーバを利用して解決しようとする前に、フォワーダを利用して DNS の問い合わせを解決するようにします。 <systemitem>forward first</systemitem> ではなく <systemitem>forward only</systemitem> を指定すると、ルートネームサーバを使用せずにフォワーダのみを使用するようになります。これは特にファイアウオールを利用するような場合に便利です。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on port 53 { 127.0.0.1; <replaceable>IP_アドレス</replaceable> ; };</term>
     <listitem>
      <para>BIND に対してネットワークインターフェイスを指定するほか、クライアントからの問い合わせを受け付けるポートを指定します。 <literal>53</literal> は既定のポートであるため、 <literal>port 53</literal> を明示的に指定する必要はありません。また、 <literal>127.0.0.1</literal> を指定して、ローカルホストからのアクセスについては必ず受け付けるようにしてください。この設定を全く行なわない場合は、全てのインターフェイスを利用して問い合わせを受け付けるようになります。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>listen-on-v6 port 53 {any; };</term>
     <listitem>
      <para>BIND に対して IPv6 のクライアントからの問い合わせを受け付けるように指定しています。 <literal>any</literal> (任意のアドレス) 以外には <literal>none</literal> (全てのアドレスを拒否) を指定することもできます。 IPv6 については、ワイルドカードアドレスを指定することもできます。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source address * port 53;</term>
     <listitem>
      <para>この項目は、ファイアウオールが外部宛の DNS リクエストをブロックしているような場合に必要となります。この設定により、 BIND はポート 53 からリクエストを送信するようになり、 1024 以上のポートを使用しなくなります。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>query-source-v6 address * port 53;</term>
     <listitem>
      <para>BIND に対して、 IPv6 の問い合わせで使用するポートを指定しています。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-query { 127.0.0.1; <replaceable>NET</replaceable> ; };</term>
     <listitem>
      <para>どのクライアントから DNS のリクエストを受け付けるのかを指定します。 <replaceable>NET</replaceable> には <literal>&subnetIImask;</literal> のように、アドレス情報を指定してください。 <systemitem>/24</systemitem> はネットマスクの省略表記で、この例の場合は <systemitem class="netmask">255.255.255.0</systemitem> を意味します。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-transfer ! *;;</term>
     <listitem>
      <para>どのホストからのゾーン転送要求を受け入れるのかを指定します。 <systemitem>! *</systemitem> の例では、全てのホストからの要求を拒否します。この項目を指定しない場合、ゾーン転送は全てのホストから実施できるようになります。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>statistics-interval 0;</term>
     <listitem>
      <para>上記の項目を設定しない場合、 BIND はシステムのジャーナル内に、 1 時間おきに統計情報を出力するようになります。 0 を指定すると、この統計情報を省略することができます。 0 以外の値を指定する場合は、分単位で指定します。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cleaning-interval 720;</term>
     <listitem>
      <para>このオプションは、 BIND がキャッシュを清掃する時間間隔を指定します。この清掃が行なわれると、システムのジャーナルに対しても出力が行なわれます。時間は分単位で指定します。既定値は 60 分です。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>interface-interval 0;</term>
     <listitem>
      <para>BIND では新しいネットワークインターフェイスや存在しなくなったインターフェイスを、定期的に検索します。この値を <systemitem>0</systemitem> にすると、 BIND は新しいインターフェイスを使用しなくなり、起動時に検出されたインターフェイスのみを使用するようになります。それ以外の場合は分単位で指定してください。既定値は 60 分です。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>notify no;</term>
     <listitem>
      <para><option>no</option> を指定すると、ゾーンデータに修正が発生したような場合や、ネームサーバが再起動されたような場合に、他のネームサーバに通知を送信しなくなります。</para>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>利用可能なオプションの一覧については、 <command>man 5 named.conf</command> のマニュアルページをお読みください。</para>
  </sect2>

  <sect2 xml:id="sec.dns.named.log">
   <title>ログ</title>
   <para>BIND では、ログ記録を行なう種類と方法、場所をそれぞれ設定することができます。通常は既定値のままでかまいません。なお、 <xref linkend="ex.no.log"/> には一切のログ記録を無効化するための最も簡単な設定が示されています。</para>
   <example xml:id="ex.no.log">
    <title>ログ記録を無効化するための設定</title>
<screen>logging {
        category default { null; };
};</screen>
   </example>
  </sect2>

  <sect2 xml:id="sec.dns.named.zones">
   <title>ゾーンの項目</title>
   <example xml:id="ex.meine.domain">
    <title>example.com に対するゾーン項目</title>
<screen>zone "example.com" in {
      type master;
      file "example.com.zone";
      notify no;
};</screen>
   </example>
   <para><xref linkend="ex.meine.domain"/> に示されているとおり、まず <systemitem>zone</systemitem> の後ろには、管理対象のドメイン名を指定 ( <systemitem class="domainname">example.com</systemitem> ) し、それに続いて <systemitem>in</systemitem> と波括弧を記述します。 <emphasis>スレーブゾーン</emphasis> を定義するには、 <systemitem>type</systemitem> を <literal>slave</literal> にして <literal>masters</literal> でマスターサーバを指定してください (詳しくは <xref linkend="ex.andere.domain"/> をご覧ください) 。</para>
   <example xml:id="ex.andere.domain">
    <title>&exampledomain1; に対するゾーン項目</title>
<screen>zone "&exampledomain1;" in {
      type slave;
      file "slave/&exampledomain1;.zone";
      masters { 10.0.0.1; }; <!-- network scheme: What is this external DNS' IP supposed to be?
      bg: we still did not define the addresses of a public internet.-->
};</screen>
   </example>
   <para>それぞれの項目の意味は下記の通りです:</para>
   <variablelist>
    <varlistentry>
     <term>type master;</term>
     <listitem>
      <para><literal>master</literal> を指定することで、 BIND は指定したゾーンをローカルのネームサーバ内で処理するようになります。なお、ゾーンファイルは正しい形式で作成している必要があります。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type slave;</term>
     <listitem>
      <para>このゾーンは、あらかじめ他のネームサーバから情報を転送して提供するものであることを示しています。この宣言を行なった場合、 <systemitem>masters</systemitem> もあわせて指定しなければなりません。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>type hint;</term>
     <listitem>
      <para>ゾーン <literal>.</literal> に対して設定されている <literal>hint</literal> とは、ルートネームサーバを設定する際に使用するものです。このゾーンの設定は、変更したりせずそのままにしておいてください。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>file <filename>&exampledomain;.zone</filename> および file <quote>slave/&exampledomain1;.zone</quote> ;</term>
     <listitem>
      <para>この項目は、指定したドメインに対するゾーンデータが、どこに配置されているのかを示すものです。スレーブゾーンの場合は、ゾーンデータをマスターサーバから取得するため、 file で指定したファイルが存在している必要はありません。ただし、スレーブゾーンの場合は <filename>slave</filename> ディレクトリ内に配置して区別するようにしてください。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>masters { <replaceable>サーバの_IP_アドレス</replaceable> ; };</term>
     <listitem>
      <para>この項目はスレーブゾーンの場合にのみ指定すべき項目です。ネームサーバのゾーンデータを、どこから取得するのかを指定します。</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>allow-update {! *; };</term>
     <listitem>
      <para>この項目は外部からの書き込みアクセスを制御するもので、どのクライアントから DNS の項目を修正できるのかを指定します。セキュリティ上の理由から、必要な場合を除いて許可すべきではないものです。この項目を指定しない場合、全ての修正が拒否されます。なお、上記の <literal>! *</literal> のように指定しても同じ意味になり、全てのクライアントからの修正を拒否します。</para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.dns.zonefile">
  <title>ゾーンファイル</title>

  <para>ゾーンファイルに対しては、 2 種類のものが必要となります。 1 つはホスト名に IP アドレスを割り当てるもので、もう 1 つはその逆に IP アドレスにホスト名を割り当てるものです。</para>

  <tip>
   <title>ゾーンファイル内でのドット (ピリオド) の使用について</title>
   <para>ゾーンファイル内では、 <literal>"."</literal> は特別な意味を持ちます。たとえばホスト名の末尾がドットで終わっていない場合、ゾーンのドメイン名が後ろに付いているものと見なされます。完全修飾ドメイン名の場合は、必ずドット (<literal>.</literal>) で終わらなければなりません。ドットで終わらないと、さらにドメイン名が付与されてしまいます。また、 "." を誤った位置に配置したり、記述すべき箇所に記述しなかったりすると、ネームサーバの設定エラーを引き起こします。</para>
  </tip>

<!-- comment from Lucas Ocilka
> g) page 437 - TIP - Using the Dot in Zone Files
> - - - example zone "new.example.com" - - -
> $TTL 2d
> @               IN SOA          wizard.suse.cz. root.wizard.suse.cz. (
> 2005030101      ; serial
> 3h              ; refresh
> 1h              ; retry
> 1w              ; expiry
> 1d )            ; minimum
>
> new.example.com.        IN NS           wizard.suse.cz.
> wizard          IN A            10.88.0.1
> doe             IN A            10.88.0.3
> jeff            IN CNAME        joe
> $ORIGIN example.com.
> joe.new         IN A            10.88.0.2
> - - - example zone "new.example.com" - - -
> The TIP says that when some record is not finished with a dot ".", the zone is
> appended. It is only a part of truth, the "$ORIGIN" record would rewrite the
> appended string.
> In this case "joe.new"+$ORIGIN is "joe.new.example.com."
> `dig A jeff.new.example.com. @server`
> - - - returns - - -
> ;; ANSWER SECTION:
> jeff.new.example.com.   172800  IN      CNAME   joe.new.example.com.
> joe.new.example.com.    172800  IN      A       10.88.0.2
> - - - returns - - -
> More docu: http://www.zytrax.com/books/dns/apa/dot.html
- - -
> Syntactical issue: "." dot could be quoted... (ke: done)
-->

  <para>まずは <filename>&exampledomain;.zone</filename> というゾーンファイルについて説明を行ないます。このゾーンファイルは <filename>&exampledomain;</filename> というドメインに対するゾーンファイルです。 <xref linkend="ex.welt.zone"/> に例を示しています。</para>

  <example xml:id="ex.welt.zone">
   <title>/var/lib/named/&exampledomain;.zone ファイル</title>
   <screen>$TTL 2D <co xml:id="welt.zone.ttl"/>
&exampledomain;. IN SOA      dns  root.&exampledomain;. ( <co xml:id="welt.zone.soa_start"/>
             2003072441  ; シリアル番号 <co xml:id="welt.zone.serial_no"/>
             1D          ; 更新間隔 <co xml:id="welt.zone.refresh"/>
             2H          ; 再試行間隔 <co xml:id="welt.zone.retry"/>
             1W          ; 有効期限 <co xml:id="welt.zone.expire"/>
             2D )        ; ネガティブキャッシュ TTL <co xml:id="welt.zone.caching_time"/>

             IN NS       dns <co xml:id="welt.zone.inns"/>
             IN MX       10 mail dns <co xml:id="welt.zone.mx"/>
gate         IN A        &gateip; <co xml:id="welt.zone.ips"/>
             IN A        10.0.0.1
dns          IN A        &dnsip;
mail         IN A        &mailip;
&wsI;      IN A        &wsIip;
&wsII;        IN A        &wsIIip;
&wsIII;       IN A        &wsIIIip;
&wsIV;      IN A        &wsIVip;
ntp          IN CNAME    dns <co xml:id="welt.zone.ntp"/>
dns6         IN A6  0    &dnsipv6;</screen>
<!--
   removed:
   As it makes no sense with 'www' as a normal host name.
   removed:
   moon        IN A        192.168.0.3
   earth       IN A        192.168.1.2
   mars        IN A        192.168.1.3
   -->
  </example>

  <calloutlist>
   <callout arearefs="welt.zone.ttl">
    <para><systemitem>$TTL</systemitem> は、このファイル内の全ての項目に対して適用される、既定の有効期間 (Time-to-Live) を設定します。この例では、各項目は 2 日間有効となっています ( <literal>2 D</literal> ) 。</para>
   </callout>
   <callout arearefs="welt.zone.soa_start">
    <para>この行が SOA (権威開始; Start Of Authority) 制御レコードの開始位置です:</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>まずは対象のドメイン (<literal>&exampledomain;</literal>) を最初に指定します。ここではドメイン名を再度追加されてしまうことのないよう、 <literal>"."</literal> で終わらせる必要があります。また、 1 文字で <literal>@</literal> を指定することもできますが、この場合は <filename>/etc/named.conf</filename> から対応する項目を抽出する意味になります。</para>
     </listitem>
     <listitem>
      <para><systemitem>IN SOA</systemitem> の後ろには、このゾーンを担当するネームサーバの名前を指定します。この項目は <literal>"."</literal> で終わっていませんので、 <literal>dns</literal> は <literal>&dnsname;</literal> に展開されます。</para>
     </listitem>
     <listitem>
      <para>ネームサーバの管理を行なっている管理者の電子メールアドレスを指定します。ただし、 <literal>@</literal> はゾーンファイル内では特別な意味を持ちますので、代わりに <literal>"."</literal> を使用します。たとえば <systemitem>root@&exampledomain;</systemitem> の場合は、 <systemitem>root.&exampledomain;.</systemitem> となります。また、ドメイン名を再度追加されてしまうことのないよう、末尾には <literal>"."</literal> を付けなければなりません。</para>
     </listitem>
     <listitem>
      <para>その後の <literal>(</literal> から <literal>)</literal> までが SOA レコードとなります。</para>
     </listitem>
    </itemizedlist>
   </callout>
   <callout arearefs="welt.zone.serial_no">
    <para><systemitem>シリアル番号</systemitem> は 10 桁の番号を指定しています。この数値は、ゾーンファイルが変更されるたびに変えなければなりません。この数値はセカンダリネームサーバ (スレーブサーバ) に対して変更を通知するためのもので、一般的には YYYYMMDDNN の書式で指定します ( YYYY = 年, MM = 月, DD = 日, NN = 順序番号) 。なお、 NN は 1 日の間に複数回の変更を行なった場合に使用する箇所です。</para>
   </callout>
   <callout arearefs="welt.zone.refresh">
    <para><systemitem>更新間隔</systemitem> は、セカンダリネームサーバがゾーンの <systemitem>シリアル番号</systemitem> を確認する時間間隔を指定します。この例では 1 日になっています。</para>
   </callout>
   <callout arearefs="welt.zone.retry">
    <para><systemitem>再試行間隔</systemitem> はセカンダリネームサーバで何らかのエラーが発生した場合に、プライマリネームサーバにアクセスする時間間隔を指定します。この例では 2 時間になっています。</para>
   </callout>
   <callout arearefs="welt.zone.expire">
    <para><systemitem>有効期限</systemitem> は、セカンダリサーバからプライマリサーバにアクセスすることができなくなった場合に、キャッシュ済みのデータを廃棄するまでの時間を指定します。この例では 1 週間になっています。</para>
   </callout>
   <callout arearefs="welt.zone.caching_time">
    <para>SOA レコードの最後の項目は <systemitem>ネガティブキャッシュ TTL</systemitem> で、他のコンピュータからの問い合わせで、解決することのできなかった DNS の問い合わせをキャッシュしておく時間を指定します。</para>
   </callout>
   <callout arearefs="welt.zone.inns">
    <para><systemitem>IN NS</systemitem> の行は、このドメインに対するネームサーバを指定するための項目です。 <systemitem>dns</systemitem> は <literal>"."</literal> で終わっていないため、 <systemitem>&dnsname;</systemitem> に展開されます。また、この行は複数のサーバ (プライマリ、セカンダリなど) を指定する目的で、複数指定することもできます。この場合は <systemitem>IN NS</systemitem> の行を複数記述してください。また、 <filename>/etc/named.conf</filename> で <systemitem>notify</systemitem> に <option>no</option> を指定していない場合、ゾーンの更新が発生すると、ここに記述している全てのネームサーバに対して通知が行なわれます。</para>
   </callout>
   <callout arearefs="welt.zone.mx">
    <para>MX レコードは、このドメイン (<systemitem class="domainname">&exampledomain;</systemitem>) に対するメールを受け取って処理したり、転送したりするためのメールサーバを指定します。この例では <systemitem class="domainname">&mailname;</systemitem> がメールサーバに指定されています。ホスト名の前に設定されている数値は優先順位を表わす値で、複数の MX レコードが存在した場合、その中で最も小さい優先順位の値のメールサーバを優先して使用します。もしもそのサーバ宛のメール配送が失敗した場合は、次に小さい優先順位のメールサーバを使用します。</para>
   </callout>
   <callout arearefs="welt.zone.ips">
    <para>この行以降が実際のアドレスレコードで、 1 つ以上の IP アドレスをホスト名に割り当てています。それぞれのホスト名には <literal>"."</literal> が含まれていないため、それぞれに対して <systemitem class="domainname">&exampledomain;</systemitem> が設定されます。なお、 <systemitem>gate</systemitem> には 2 つの IP アドレスが割り当てられていますが、これは 2 枚のネットワークカードが接続されていることによるものです。 <!-- looks as if we don't support A6 at least with YAST --> ホストに対して割り当てるアドレスが従来のもの (IPv4) であった場合、レコードは <literal>A</literal> レコードになります。 IPv6 アドレスを指定する場合は、 <literal>AAAA</literal> レコードになります。 <!-- The previous token for IPv6 addresses was only <literal>AAAA</literal>, which is now obsolete. --></para>
<!-- bug 63609-->
<!-- bg: see RFC 1886, RFC 2874 -->
     <note>
      <title>IPv6 の書式について</title>
      <para>IPv6 アドレスを指定する場合は、 IPv4 とは異なる書式で指定します。 IPv6 アドレスは IPv4 アドレスよりも長いものの、中間部分にゼロが入ることが多いため、その部分を省略して表記するためです。 IPv6 アドレスのうち、 <quote>0</quote> が連続する部分については、コロンを 2 つ付けて省略します。 <!-- You must provide this information even if you want to use a completely unfragmented address. For the AAAA record with the syntax --></para>
<screen>pluto     AAAA 2345:00C1:CA11::1234:5678:9ABC:DEF0
pluto     AAAA 2345:00D2:DA11::1234:5678:9ABC:DEF0</screen>
<!--      <para>
       You need to add information about missing bits in IPv6 format.
       Because the example above is complete (does not miss any bits), the
       A6 format of this record is:
      </para>
<screen>pluto  IN            A6 0 2345:00C1:CA11:0001:1234:5678:9ABC:DEF0
 pluto  IN            A6 0 2345:00D2:DA11:0001:1234:5678:9ABC:DEF0</screen> -->
     </note>
   </callout>
   <callout arearefs="welt.zone.ntp">
    <para><literal>ntp</literal> を <literal>dns</literal> の別名として使用する設定です。 (<systemitem>CNAME</systemitem> は <emphasis>canonical name</emphasis> (正式名称) の略です) 。</para>
   </callout>
  </calloutlist>

<!-- jh: I shortened the prefix to two octets to encompass the whole network. -->

  <para>疑似ドメインである <literal>in-addr.arpa</literal> は、 IP アドレスからホスト名への逆変換を行なう際に使用するドメインです。このドメインの前にアドレスを逆順で記述してドメイン名とします。たとえば <systemitem class="ipaddress">192.168</systemitem> のアドレスに対する逆引きドメインは <systemitem>168.192.in-addr.arpa</systemitem> になります。詳しくは <xref linkend="dat.arpa"/> をご覧ください。</para>

<!-- make some sense in the reverse lookup - maybe do just 168.192. ... ? -->

  <example xml:id="dat.arpa">
   <title>逆引き参照</title>
   <screen>$TTL 2D <co xml:id="data.arpa.ttl"/>
168.192.in-addr.arpa.   IN SOA &dnsname;. root.&exampledomain;. ( <co xml:id="data.arpa.soa"/>
                        2003072441      ; シリアル番号
                        1D              ; 更新間隔
                        2H              ; 再試行間隔
                        1W              ; 有効期限
                        2D )            ; ネガティブキャッシュ TTL

                        IN NS           &dnsname;. <co xml:id="data.arpa.inns"/>

1.5                     IN PTR          &gatename;. <co xml:id="data.arpa.ips"/>
100.3                   IN PTR          &wwwname;.
253.2                   IN PTR          &cupsname;.</screen>
  </example>

  <calloutlist>
   <callout arearefs="data.arpa.ttl">
    <para>$TTL は、このファイル内の全ての項目に対して適用される、既定の有効期間 (Time-to-Live) を設定します。</para>
   </callout>
   <callout arearefs="data.arpa.soa">
    <para>この行は <systemitem class="ipaddress">192.168</systemitem> のネットワークに対する逆引き参照を定義しています。そのため、ゾーン名 (ドメイン名) は <systemitem>168.192.in-addr.arpa</systemitem> になります。そのため、逆引きゾーンでホスト名を記述する際は、必ず完全修飾ドメイン名でなければならず、かつ <literal>"."</literal> で終わらなければなりません。残りの項目については、上記の <systemitem>&exampledomain;</systemitem> に対する例と同じです。</para>
    <para>このレコード内の各項目に対する詳細は、 <xref linkend="ex.welt.zone"/> をお読みください。</para>
   </callout>
   <callout arearefs="data.arpa.inns">
    <para>この行では、このゾーンに対するネームサーバを指定しています。前述の通り、ホスト名は完全修飾ドメイン名で記述しなければならず、かつ <literal>"."</literal> で終わらなければなりません。</para>
   </callout>
   <callout arearefs="data.arpa.ips">
    <para>この行以降は IP アドレスと対応するホスト名を記述しています。 IP アドレスについては末尾だけを逆順で記述し、 <literal>"."</literal> を最後に付けていません。これにより、自動的にゾーン名が末尾に追加されることになり、 <systemitem>.in-addr.arpa</systemitem> で終わる名前になるようになっています。</para>
   </callout>
  </calloutlist>
  <para>なお、 BIND のバージョンが異なっていても、ゾーンの転送は問題なく実施することができます。</para>
 </sect1>
<!--rw-trans moved section up from later in this file-->
 <sect1 xml:id="sec.dns.dynupdate">
  <title>ゾーンデータの動的な更新</title>

  <para><emphasis>動的な更新</emphasis> とは、マスターサーバ内のゾーンファイルの項目を、動的に追加したり変更したり削除したりする機能を意味します。この仕組みは RFC&nbsp;2136 に規定されていて、各ゾーンの項目内に <systemitem>allow-update</systemitem> や <systemitem>update-policy</systemitem> のルールを指定することで、有効化することができます。ただし、動的に更新するゾーンについては、手作業でゾーンファイルを編集すべきではありません。</para>

  <para>DNS サーバに対して更新要求を送信するには、 <command>nsupdate</command> コマンドを使用します。このコマンドの正確な書式については、 nsupdate のマニュアルページ (<command>man</command> &nbsp; <option>8 nsupdate</option> をご覧ください。なお、セキュリティ上の理由から、 <xref linkend="sec.dns.tsig"/> で説明している TSIG 鍵の使用をお勧めします。</para>
 </sect1>
 <sect1 xml:id="sec.dns.tsig">
  <title>トランザクションの暗号化</title>

  <para>トランザクションの暗号化は、共有機密鍵をベースにしたトランザクション署名 (TSIG) を利用して行ないます (そのため、 TSIG 鍵とも呼ばれます) 。本章では、このような鍵を生成し、使用する方法について説明しています。</para>

  <para>トランザクションの暗号化は、サーバ間での通信のほか、ゾーンデータの動的な更新を行なう場合に必要となります。鍵に依存したアクセス制御を設定することで、 IP アドレスだけに依存するよりもずっと機密を保持できるようになります。</para>

  <para>TSIG 鍵を生成するには、下記のコマンドを実行します (詳しくは <command>man</command> &nbsp; <option>dnssec-keygen</option> をお読みください):</para>

<screen>&prompt.sudo;dnssec-keygen -a hmac-md5 -b 128 -n HOST host1-host2</screen>

  <para>このコマンドを実行すると、下記の 2 つのファイルが作成されます:</para>

<screen>Khost1-host2.+157+34265.private Khost1-host2.+157+34265.key</screen>

  <para>鍵それ自身 (<literal>ejIkuCyyGJwwuN3xAteKgg==</literal> のような文字列) は、いずれのファイル内にも存在します。更新処理で使用する場合は、後者のファイル ( <filename>Khost1-host2.+157+34265.key</filename> ) を相手側のホストに転送してください。できる限り、 scp などの暗号化のある転送手段で転送を行なってください。相手側のホストでは、 <filename>/etc/named.conf</filename> 内で転送したファイルを参照するよう指定し、 <literal>host1</literal> と <literal>host2</literal> との間で機密を確保するようにします:</para>

<screen>key host1-host2 {
 algorithm hmac-md5;
 secret "ejIkuCyyGJwwuN3xAteKgg==";
};</screen>

  <warning>
   <title><filename>/etc/named.conf</filename> のアクセス権について</title>
   <para><filename>/etc/named.conf</filename> に対するアクセス権 (パーミッション) が正しく制限されていることを確認してください。このファイルの既定のアクセス権は <literal>0640</literal> で、所有者は <systemitem class="username">root</systemitem> 、グループは <systemitem class="username">named</systemitem> になっているはずです。また、 <filename>/etc/named.conf</filename> から別のファイルを参照するように指定することで、異なるアクセス権のファイルを取り込むこともできます。別のファイルを参照するには、下記のように指定します:</para>
<screen>include  "ファイル名"</screen>
   <para><option>ファイル名</option> の欄には、絶対パスで参照すべきファイルを指定します。</para>
  </warning>

  <para><!--adjust to standard network example--> <!-- network schema: We have no 2xDNS setup, i used a disjoint network for --> <!-- this. Is this a problem? After all, this is just an illustration of how --> <!-- to put a key for a host, and not a beginner topic. Anyway, we'd need a --> <!-- secondary server. --> サーバ <literal>host1</literal> に対して、 <literal>host2</literal>  (この例では、アドレス <literal>10.1.2.3</literal>) 向けの鍵を使用するようにするには、サーバ側の <filename>/etc/named.conf</filename> 内に下記のルールを含めなければなりません:</para>

<screen>server 10.1.2.3 {
  keys { host1-host2. ;};
};</screen>

  <para><literal>host2</literal> 側の設定についても、同様の項目を含めなければなりません。</para>

  <para>あとは TSIG 鍵を、 IP アドレスやアドレスの範囲を指定している任意の ACL (アクセス制御リスト (Access Control List) 、ファイルのアクセス権 (パーミッション) と混同しないでください) に設定して、許可を付与します。たとえば下記のようになります:</para>

<screen>allow-update { key host1-host2. ;};</screen>

  <para>さらに詳しい説明については、 <emphasis>BIND Administrator Reference Manual</emphasis> 内の <literal>update-policy</literal> をお読みください。</para>
 </sect1>
 <sect1 xml:id="sec.dns.dnssec">
  <title>DNS セキュリティ</title>

  <para>DNSSEC や DNS セキュリティは、 RFC&nbsp;2535 に規定されています。 DNSSEC 向けのツールは、 BIND マニュアルに説明があります。</para>

  <para>機密を保持すべきゾーンに対しては、 1 つまたは複数のゾーン鍵を結びつけて使用します。これらはホスト鍵を作成する際に使用した <command>dnssec-keygen</command> で生成することができます。現時点では、 DSA 暗号化アルゴリズムほ使用してこれらの鍵を生成します。対応するゾーン内の <systemitem>$INCLUDE</systemitem> ルールで、対応するゾーン内に公開鍵を結びつけます。</para>

  <para><command>dnssec-signzone</command> コマンドを使用すると、生成鍵のセット ( <literal>keyset-</literal> ファイル) を作成することができます。これらを機密を保持する方法で親ゾーンに渡して、署名をしてもらってください。署名の結果は <filename>/etc/named.conf</filename> 内の各ゾーンで取り込むように設定します。</para>

<!-- 2011-08-30, toba: dnssec-makekeyset and dnssec-signkey are gone in 11 SP2
  <para>
   With the command <command>dnssec-makekeyset</command>, all keys generated
   are packaged into one set, which must then be transferred to the parent
   zone in a secure manner. On the parent, the set is signed with
   <command>dnssec-signkey</command>. The files generated by this command
   are then used to sign the zones with <command>dnssec-signzone</command>,
   which in turn generates the files to include for each zone in
   <filename>/etc/named.conf</filename>.
  </para>
  -->
 </sect1>
 <sect1 xml:id="sec.dns.info">
  <title>さらなる情報</title>

  <para>より詳しい情報については、 <systemitem class="resource">bind-doc</systemitem> パッケージ内の <filename>/usr/share/doc/packages/bind/arm</filename> ディレクトリに含まれる、 <emphasis>BIND Administrator Reference Manual</emphasis> (BIND 管理者向けリファレンスマニュアル) をお読みください。また、マニュアルや BIND のマニュアルページから参照されている、各種の RFC についてもお読みになることをお勧めします。また、 &productname; での最新情報については、 <filename>/usr/share/doc/packages/bind/README.SUSE</filename> をお読みください。</para>
 </sect1>
</chapter>
